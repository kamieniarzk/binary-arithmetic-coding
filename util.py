def getBinaryFromInt(curr_int):
    print_num = bin(curr_int)[2:]
    while len(print_num) < 8:
        print_num = '0' + print_num
    return print_num

def read_pgm(pgmf):
    """Return a raster of integers from a PGM as a list of lists."""
    first_line = pgmf.readline()
    assert first_line == b'P5\n'
    pgmf.readline()
    second_line = pgmf.readline()
    (width, height) = [int(i) for i in second_line.split()]
    depth = int(pgmf.readline())
    assert depth <= 255

    raster = []
    for y in range(height):
        row = []
        for y in range(width):
            row.append(ord(pgmf.read(1)))
        raster.append(row)
    return raster

def test_arithmetic_encoding_decoding(input_string):
    messages = []
    messages.append('#######################################\n')
    messages.append(f'#### TESTING INPUT: {input_string}\n')
    messages.append('#######################################\n')
    output, prob_map, N = integer_arithmetic_encoding(input_string)
    print(prob_map)
    decoded = integer_arithmetic_decoding(output, prob_map, N)
    decoded_string = ''.join(list(map(str, decoded)))
    is_success = decoded_string == input_string
    if is_success:
        messages.append('#######################################\n')
        messages.append('#### TEST PASSED ######################\n')
        messages.append('#######################################\n')
    else:
        messages.append('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n')
        messages.append('#### TEST FAILED ######################\n')
        messages.append(f'output: {decoded_string}\n')
        messages.append('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n')
    return messages

def test_code():
    test_strings = ['AB', 'ABC', 'AAC', 'AAAC', 'AAAAC', 'AACC', 'ACAC', 'AABC', 'ACA', '1234567890', '1234567890', 'ARYTMETYKA', '1111100000',
                    '1234554321', '0000055555', ';lasdjvkop3r92orufe90fuoasdjfvkvnawopsidf0933']

    for i in range(256):
        test_strings.append(getBinaryFromInt(i))

    messages = []
    for test_string in test_strings:
        messages += test_arithmetic_encoding_decoding(test_string)
        messages += '\n'

    for message in messages:
        print(message)

    # test_arithmetic_encoding_decoding('AAC')


def test_code_file_output():
    string1 = '1111111110000010111111101011111100101111011101110101101010101'
    string2 = '111111111000001011111110101111110010111101110111010110101010101010111111110'
    string3 = '10101010111010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110'
    string4 = '10101010111010101010111100000101011010110101010101010101010101010101010111111111111000001101111111010111111001011110111011101011010101010101011111110111111101011111100101111011101110101101010101010101111111011111110101111110010111101110111010110101010101010111111011111110101111110010111101110111010110101010101010111111110'
    string5 = '101010101110101010101010101110101010101111000001011010101011101010101011110000010101101011010101010110101010111010101010111100000101011010110101010101011101010101011110000010101010101010101010111010101010111100000101010101110101010101111000001010110101010111010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111011010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110010111010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110'
    string6 = '101010101110101010101010101110101010101111000001011010101011101010101011110000010101101011010101010110101010111010101010111100000101011010110101010101011101010101011110000010101010101010101010111010101010111100000101010101110101010101111000001010110101010111010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111011010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110010111010101010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010111100000101011010110101010101010101010101010101010111111111111000001011111110101111110010111101110111010110101010101010111111110101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010111010101010101010111010101010111100000101101010101110101010101111000001010110101101010101011010101011101010101011110000010101101011010101010101110101010101111000001010101010101010101011101010101011110000010101010111010101010111100000101011010101011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101010110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111001011101010101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111100110101101010101010101010101010101010101111111111110000010111111101011111100101111011101110101101010101010101111111101011110000010101101011010101010101010101010101010101011111111111100000101111111010111111001011110111011101011010101010101011111111010'
    test_strings = ['AB', 'ABC', 'AAC', 'AAAC', 'AAAAC', 'AACC', 'ACAC', 'AABC', 'ACA', '1234567890', '1234567890', 'ARYTMETYKA', '1111100000',
                    '1234554321', '0000055555', ';lasdjvkop3r92orufe90fuoasdjfvkvnawopsidf0933', string1, string2, string3, string4, string5]
    with open('./logs.txt', 'w') as log_file:
        # for i in range(1024 * 1024, 1024 * 1024 + 1000):
        #     test_strings.append(getBinaryFromInt(i))

        messages = []
        for test_string in test_strings:
            messages += test_arithmetic_encoding_decoding(test_string)
            messages += '\n'

        for message in messages:
            log_file.write(message)

    # test_arithmetic_encoding_decoding('AAC')


def read_file_bits(filename):
    with open(filename, 'rb') as f:
        out = []
        while 1:
            byte_s = f.read(1)
            if not byte_s:
                break
            for bit in bin(int(byte_s.hex(), base=16))[2:]:
                out.append(bit)
        return out